"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_construct2=_interopRequireDefault(require("@babel/runtime/helpers/construct")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));function Task(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"open";this.id=e,this.name=t,this.priority=n,this.status=r}var tasksArr,prepareData=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):fetch("data/data.json").then(function(e){return e.json()}).then(function(e){return e})},addClassForElements=function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach(function(e){return e.classList.add(t)})},removeClassFromElements=function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach(function(e){return e.classList.remove(t)})},validateFormOrShowErrorMessage=function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(!s.value)return showErrorMessage(s.parentNode),!1}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!0},showErrorMessage=function(e){removeClassFromElements("hide",e.nextElementSibling)},hideAllErrorMessages=function(e){var t=e.querySelectorAll(".error-message");addClassForElements.apply(void 0,["hide"].concat((0,_toConsumableArray2.default)(t)))},clearAllFormFields=function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;"button"!==s.type&&(s.value="")}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}},getFormData=function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var i=o.value;"button"!==i.type&&t.push(i.value)}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return t},getIdForNewTask=function(e){return e.length?e[e.length-1].id+1:1},updateTasksListAndLocalStorage=function(e,t,n){t.innerHTML=createAllTasksHTML(e),localStorage.setItem(n,JSON.stringify(e))},getTaskData=function(e,t){return e.find(function(e){return e.id===t})},getTaskIndex=function(e,t){return e.findIndex(function(e){return e.id===t})},createConfirmDeletionBlock=function(){return'\n        <div class="confirm-deletion-block">\n            <span>Are you sure?</span>\n            <div>\n                <button class="confirm-deletion-btn">Confirm</button>\n                <button class="cancel-deletion-btn">Cancel</button>\n            </div>\n        </div>\n    '},createTaskNameChangingForm=function(){return'\n        <form class="change-task-name-form">\n            <label>\n                Enter new task name:\n                <input type="text" class="task-name-input" placeholder="Name...">\n            </label>\n             <div class="error-message hide">Please, fill this field first</div>\n            <input type="button" class="confirm-name-changing-btn" value="Submit">\n        </form>\n    '},createErrorMessage=function(e){return'<div class="error-message">'.concat(e,"</div>")},createTaskHTML=function(e){var t=e.id,n=e.name,r=e.status,a=e.priority;return'\n        <li class="todo-list-item" data-id="'.concat(t,'">\n            <div class="todo-list-item-top">\n                <span class="task-name">').concat(n,'</span>\n                <div>\n                    <button class="edit-btn">Edit</button>\n                    <button class="delete-btn">Delete</button> \n                </div>\n            </div>\n            <div class="todo-list-item-bottom">\n                <div>\n                    <span><i>Current status:</i> ').concat(r,'</span>\n                    <select>\n                        <option value="">Select status</option>\n                        <option value="open">Open</option>\n                        <option value="in progress">In progress</option>\n                        <option value="done">Done</option>\n                    </select>\n                    <button class="change-status-btn">Change status</button>\n                </div>\n                <div>\n                    <span class="').concat(a,'"><i>Current priority:</i> ').concat(a,'</span>\n                    <select>\n                        <option value="">Select priority</option>\n                        <option value="low">Low</option>\n                        <option value="medium">Medium</option>\n                        <option value="high">High</option>\n                    </select>\n                    <button class="change-priority-btn">Change priority</button>\n                </div>\n            </div>\n            <div class="todo-list-item-info"></div>\n        </li>\n    ')},createAllTasksHTML=function(e){return e.map(createTaskHTML).join("")},controlTasks=function(){var t;return _regenerator.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector(".todo-list"),e.next=3,_regenerator.default.awrap(prepareData(TASKS_STORAGE_NAME));case 3:tasksArr=e.sent,t.innerHTML=createAllTasksHTML(tasksArr),t.addEventListener("click",handleClickOnTodoList);case 6:case"end":return e.stop()}})},controlModalWindowAction=function(){var n=document.querySelector(".modal-wrapper"),r="show-modal-wrapper",e=document.querySelector(".add-btn"),t=document.querySelector(".close-btn"),a=function e(t){"Escape"===t.key&&(removeClassFromElements(r,n),document.removeEventListener("keydown",e))};e.addEventListener("click",function(){addClassForElements(r,n),document.addEventListener("keydown",a)}),t.addEventListener("click",function(){removeClassFromElements(r,n),document.removeEventListener("keydown",a)})},controlModalFormConfirmation=function(){var e=document.querySelector(".submit-form-btn"),r=document.querySelector(".modal-form"),a=document.querySelector(".modal-wrapper"),o=document.querySelector(".todo-list");e.addEventListener("click",function(){if(hideAllErrorMessages(r),validateFormOrShowErrorMessage(r)){var e=getIdForNewTask(tasksArr),t=getFormData(r),n=(0,_construct2.default)(Task,[e].concat((0,_toConsumableArray2.default)(t)));tasksArr.push(n),updateTasksListAndLocalStorage(tasksArr,o,TASKS_STORAGE_NAME),removeClassFromElements("show-modal-wrapper",a),clearAllFormFields(r)}})},handleClickOnTodoList=function(e){function t(e){var t=m(),n=(0,_slicedToArray2.default)(t,2),r=n[0],a=n[1],o=d.previousElementSibling.value,s=f(r);o?(getTaskData(tasksArr,s)[e]=o,updateTasksListAndLocalStorage(tasksArr,u,TASKS_STORAGE_NAME)):a.innerHTML=createErrorMessage("Please, select ".concat(e," first"))}var n,r,a,o,s,i,l,c,u=document.querySelector(".todo-list"),d=e.target,m=function(){var e=d.closest(".todo-list-item"),t=e.querySelector(".todo-list-item-info");return[e,t]},f=function(e){var t=e.dataset.id;return parseInt(t)};d.classList.contains("edit-btn")&&(n=m(),(0,_slicedToArray2.default)(n,2)[1].innerHTML=createTaskNameChangingForm()),d.classList.contains("confirm-name-changing-btn")&&function(){var e=m(),t=(0,_slicedToArray2.default)(e,1)[0],n=f(t),r=d.parentNode;if(hideAllErrorMessages(r),validateFormOrShowErrorMessage(r)){var a=r.querySelector(".task-name-input").value;getTaskData(tasksArr,n).name=a,updateTasksListAndLocalStorage(tasksArr,u,TASKS_STORAGE_NAME)}}(),d.classList.contains("delete-btn")&&(r=m(),(a=(0,_slicedToArray2.default)(r,2)[1]).innerHTML=createConfirmDeletionBlock(a)),d.classList.contains("confirm-deletion-btn")&&(o=m(),s=(0,_slicedToArray2.default)(o,1)[0],i=f(s),l=getTaskIndex(tasksArr,i),tasksArr.splice(l,1),updateTasksListAndLocalStorage(tasksArr,u,TASKS_STORAGE_NAME)),d.classList.contains("cancel-deletion-btn")&&(c=m(),(0,_slicedToArray2.default)(c,2)[1].innerHTML=""),d.classList.contains("change-status-btn")&&t("status"),d.classList.contains("change-priority-btn")&&t("priority")},TASKS_STORAGE_NAME="todo-list";controlTasks(),controlModalWindowAction(),controlModalFormConfirmation();