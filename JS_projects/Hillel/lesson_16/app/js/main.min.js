"use strict";function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,n,e){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,n,e){var a=[null];a.push.apply(a,n);var o=new(Function.bind.apply(t,a));return e&&_setPrototypeOf(o,e.prototype),o}).apply(null,arguments)}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}function _slicedToArray(t,n){return _arrayWithHoles(t)||_iterableToArrayLimit(t,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,n){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var e=[],a=!0,o=!1,r=void 0;try{for(var c,s=t[Symbol.iterator]();!(a=(c=s.next()).done)&&(e.push(c.value),!n||e.length!==n);a=!0);}catch(t){o=!0,r=t}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return e}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function Owner(){this.setCar=function(t){this.cars?this.cars.push(t):this.cars=[t]},this.deleteCar=function(t){this.cars.splice(t,1)},this.changeBalance=function(t){this.balance+=t},this.showOwnCarsOnPage=function(){var r="";return this.cars.forEach(function(t){var n=t.name,e=t.model,a=t.yearOfConstruction,o=t.cost;r+="<li>".concat(n," ").concat(e,", ").concat(a,", ").concat(o,"$</li>")}),"<ol>".concat(r,"</ol>")},this.createFormForBuyingOrSellingCars=function(t){function n(t){return t.map(function(t){var n=t.id,e=t.name,a=t.model,o=t.yearOfConstruction,r=t.cost;return'<option value="'.concat(n,'">').concat(e," ").concat(a,", ").concat(o,", ").concat(r,"$</option>")})}var e=this.cars,a=n(carsDataArr),o=e&&e.length?n(e):"",r='<div class="error-message hide">Please, select car/car\'s first</div>';return'\n            <form class="form-group '.concat(t,'-form" data-id=').concat(this.id,'>\n                <select class="form-control available-cars" multiple="multiple">\n                    <option value="" selected>Select car/car\'s</option>\n                    ').concat(a,"\n                </select>\n                ").concat(r,'\n                <input type="button" class="btn btn-success buy-car-btn" value="Buy">\n                ').concat(o?'<select class="form-control own-cars" multiple="multiple">\n                                 <option value="" selected>Select car/car\'s</option>\n                                 '.concat(o,"\n                             </select>\n                             ").concat(r,'\n                             <input type="button" class="btn btn-danger sell-car-btn" value="Sell">'):"","\n            </form>\n        ")}}function Car(t,n,e,a,o){this.id=t,this.name=n,this.model=a,this.yearOfConstruction=e,this.cost=o}function Person(t,n,e,a,o){this.id=t,this.name=n,this.location=a,this.email=o,this.age=e,this.balance=1e5}function Company(t,n,e,a,o){this.id=t,this.name=n,this.location=a,this.officialSite=o,this.employeesAmount=e,this.balance=1e6}Car.prototype.createForm=function(t){var n=this.id,e=this.name,a=this.model,o=this.yearOfConstruction,r=this.cost,c='<div class="error-message hide">Invalid value</div>';t.innerHTML='\n        <form class="form-group car-form" '.concat(n?"data-id=".concat(n):"",'>\n            <input type="text" class="form-control" ').concat(e?'value="'.concat(e,'"'):"",' name="name" \n                placeholder="Name: starts with capital letter">\n            ').concat(c,'\n            <input type="number" class="form-control" ').concat(o?'value="'.concat(o,'"'):"",' \n                name="yearOfConstruction" placeholder="Year of construction (1885 min)" min="1885" max="2020">\n            ').concat(c,'\n            <input type="text" class="form-control" ').concat(a?'value="'.concat(a,'"'):"",' name="model" \n                placeholder="Model: starts with capital letter">\n            ').concat(c,'\n            <input type="number" class="form-control" ').concat(r?'value="'.concat(r,'"'):"",' name="cost" min="1"\n                placeholder="Car\'s cost (greater than 0)">\n            ').concat(c,'\n            <input type="button" class="btn btn-success confirm-form-btn" value="Save">\n        </form>\n    ')},Car.prototype.createAdditionalInfo=function(t){var n=this.model,e=this.yearOfConstruction,a=this.cost;t.innerHTML='\n        <ul class="car-additional-info">\n            <li><span class="important">Car model: </span>'.concat(n,'</li>\n            <li><span class="important">Year of construction: </span>').concat(e,'</li>\n            <li><span class="important">Car\'s cost: </span>').concat(a,"$</li>\n        </ul>\n    ")},Car.prototype.regExpArr={name:/^[A-Z][a-z]+$/,yearOfConstruction:/^(18(8[5-9]|9[0-9])|19[0-9]{2}|20[01][0-9])$/,model:/^[A-Z][\w ]+$/,cost:/^[1-9]\d*$/},Person.prototype=new Owner,Person.prototype.createForm=function(t){var n=this.id,e=this.name,a=this.age,o=this.location,r=this.email,c='<div class="error-message hide">Invalid value</div>';t.innerHTML='\n        <form class="form-group person-form" '.concat(n?"data-id=".concat(n):"",'>\n            <input type="text" class="form-control" ').concat(e?'value="'.concat(e,'"'):"",' name="name" \n                placeholder="Name: starts with capital letter">\n            ').concat(c,'\n            <input type="number" class="form-control" ').concat(a?'value="'.concat(a,'"'):"",' name="age" \n                placeholder="Age: 0-199" min="0">\n            ').concat(c,'\n            <input type="text" class="form-control" ').concat(o?'value="'.concat(o,'"'):"",' name="location" \n                placeholder="Location: starts with capital letter">\n            ').concat(c,'\n            <input type="email" class="form-control" ').concat(r?'value="'.concat(r,'"'):"",' name="email" \n                placeholder="Email: ivanov@gmail.com">\n            ').concat(c,'\n            <input type="button" class="btn btn-success confirm-form-btn" value="Save">\n        </form>\n        ').concat(n?this.createFormForBuyingOrSellingCars("person"):"","\n    ")},Person.prototype.createAdditionalInfo=function(t){var n=this.age,e=this.location,a=this.email,o=this.cars,r=this.balance;t.innerHTML='\n        <ul class="person-additional-info">\n            <li><span class="important">Age: </span>'.concat(n,'</li>\n            <li><span class="important">Place of residence: </span>').concat(e,'</li>\n            <li><span class="important">Email: </span>').concat(a,'</li>\n            <li><span class="important">Balance: </span>').concat(r,'$</li>\n            <li><span class="important">Cars: </span>\n                ').concat(o&&o.length?this.showOwnCarsOnPage():"No cars available","\n            </li>\n        </ul>\n    ")},Person.prototype.regExpArr={name:/^[A-Z][a-z]+$/,age:/^(?:\d|[1-9]\d|1\d\d)$/,location:/^(?:[A-Z][a-z]+ )*[A-Z][a-z]+$/,email:/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/},Company.prototype=new Owner,Company.prototype.createForm=function(t){var n=this.id,e=this.name,a=this.location,o=this.officialSite,r=this.employeesAmount,c='<div class="error-message hide">Invalid value</div>';t.innerHTML='\n        <form class="form-group company-form" '.concat(n?"data-id=".concat(n):"",'>\n            <input type="text" class="form-control" ').concat(e?'value="'.concat(e,'"'):"",' name="name" \n                placeholder="Name: starts with capital letter">\n            ').concat(c,'\n            <input type="number" class="form-control" ').concat(r?'value="'.concat(r,'"'):"",' \n                name="employeesAmount" placeholder="Employees amount (greater than 1)" min="2">\n            ').concat(c,'\n            <input type="text" class="form-control" ').concat(a?'value="'.concat(a,'"'):"",' name="location" \n                placeholder="Location: starts with capital letter">\n            ').concat(c,'\n            <input type="text" class="form-control" ').concat(o?'value="'.concat(o,'"'):"",' name="officialSite" \n                placeholder="https://www.google.com">\n            ').concat(c,'\n            <input type="button" class="btn btn-success confirm-form-btn" value="Save">\n        </form>\n        ').concat(n?this.createFormForBuyingOrSellingCars("company"):"","\n    ")},Company.prototype.createAdditionalInfo=function(t){var n=this.location,e=this.officialSite,a=this.employeesAmount,o=this.balance,r=this.cars;t.innerHTML='\n        <ul class="company-additional-info">\n            <li><span class="important">Amount of employees: </span>'.concat(a,'</li>\n            <li><span class="important">Company location: </span>').concat(n,'</li>\n            <li><span class="important">Official site: </span>').concat(e,'</li>\n            <li><span class="important">Balance: </span>').concat(o,'$</li>\n            <li><span class="important">Cars: </span>\n                ').concat(r&&r.length?this.showOwnCarsOnPage():"No cars available","\n            </li>\n        </ul>\n    ")},Company.prototype.regExpArr={name:/^(?:[A-Z][a-z]+ )*[A-Z][a-z]+$/,employeesAmount:/^(?:[2-9]|[1-9]\d+)$/,location:/^(?:[A-Z][a-z]+ )*[A-Z][a-z]+$/,officialSite:/^http(s)?:\/\/\w+\./};var peopleDataArr=[new Person(1,"Vasya",30,"Odesa","vanya@gmail.com"),new Person(2,"Viktor",25,"Kyiv","victor@gmail.com"),new Person(3,"Petya",19,"Lviv","petya@gmail.com"),new Person(4,"Andrew",67,"Moscow","andrew@gmail.com")],companiesDataArr=[new Company(1,"Google",98771,"Seattle","https://www.google.com"),new Company(2,"Morgan Stanley",60348,"New York","https://www.morganstanley.com"),new Company(3,"Tesla",45e3,"Fremont","https://www.tesla.com"),new Company(4,"Goldman Sachs",36600,"New York","https://www.goldmansachs.com")],carsDataArr=[new Car(1,"Toyota",2014,"Rav4",12e3),new Car(2,"Tesla",2019,"Model X",9e4),new Car(3,"Subaru",2010,"Impreza",2e4),new Car(4,"Mercedes",2017,"GLE 200",45e3),new Car(5,"Nissan",2018,"GTR",15e4)];function getAllItemsLists(){return[document.querySelector(".people-list"),document.querySelector(".companies-list"),document.querySelector(".cars-list")]}function createItemsList(n,e,t){t.forEach(function(t){n.innerHTML+='\n            <li class="'.concat(e,'">\n                <div class="').concat(e,'-view-panel" data-id="').concat(t.id,'">\n                    <span class="col-3">Name: ').concat(t.name,'</span>\n                    <button class="btn btn-outline-dark edit-btn">Edit</button>\n                    <button class="btn btn-outline-info view-btn">View</button>\n                    <button class="btn btn-outline-danger remove-btn">Remove</button>\n                </div>\n                <div class="').concat(e,'-info text-center" data-id="').concat(t.id,'"></div>\n            </li>\n        ')})}function prepareData(){function t(t,n){if(localStorage.getItem(t)){var e=JSON.parse(localStorage.getItem(t));switch(t){case PEOPLE_STORAGE_NAME:peopleDataArr=e.map(function(t){return Object.assign(new Person,t)});break;case COMPANIES_STORAGE_NAME:companiesDataArr=e.map(function(t){return Object.assign(new Company,t)});break;case CARS_STORAGE_NAME:carsDataArr=e.map(function(t){return Object.assign(new Car,t)})}}else localStorage.setItem(t,JSON.stringify(n))}t(PEOPLE_STORAGE_NAME,peopleDataArr),t(COMPANIES_STORAGE_NAME,companiesDataArr),t(CARS_STORAGE_NAME,carsDataArr)}function controlClicksOnMainBlock(){var t=document.querySelector(".main"),n=_slicedToArray(getAllItemsLists(),3),_=n[0],O=n[1],L=n[2];t.addEventListener("click",function(t){var a=t.target,n=_slicedToArray(a.closest(".people")||a.closest(".new-person-section")?[peopleDataArr,"person",_,PEOPLE_STORAGE_NAME]:a.closest(".companies")||a.closest(".new-company-section")?[companiesDataArr,"company",O,COMPANIES_STORAGE_NAME]:[carsDataArr,"car",L,CARS_STORAGE_NAME],4),i=n[0],l=n[1],u=n[2],p=n[3],e=function(){var t=a.parentNode,n=parseInt(t.dataset.id),e=t.nextElementSibling;return{itemId:n,itemInfoWrapper:e}}(),r=e.itemId,o=e.itemInfoWrapper,m=f(i,r);a.classList.contains("edit-btn")&&(s(o,"hide",".form-group"),m.createForm(o));a.classList.contains("view-btn")&&(s(o,"hide",".".concat(l,"-additional-info")),m.createAdditionalInfo(o));a.classList.contains("remove-btn")&&(s(o,"hide",".confirm-deletion-block"),function(t,n){t.innerHTML='\n                <div class="confirm-deletion-block">\n                    <span>Are you sure?</span>\n                    <div data-id="'.concat(n,'">\n                        <button class="btn btn-success confirm-deletion-btn">Confirm</button>\n                        <button class="btn btn-danger cancel-deletion-btn">Cancel</button>  \n                    </div>\n                </div>\n            ')}(o,r));a.classList.contains("confirm-form-btn")&&function(){var o=a.parentNode;a.closest('[class*="list"]')?function(){var t=d(i,r);if(!g(o,i[t].regExpArr))return;var n=E(o);i[t]=C.apply(void 0,[l,r].concat(_toConsumableArray(n))),b(i,u,l,p),A()}():function(){var t=C(l);if(!g(o,t.regExpArr))return;var n=E(o),e=y(i),a=C.apply(void 0,[l,e].concat(_toConsumableArray(n)));v(i,a),S(o),function(t){for(var n=0;n<t.elements.length;n++){var e=t.elements[n];"button"!==e.type&&(e.value="")}}(o),b(i,u,l,p),A()}()}();a.classList.contains("confirm-deletion-btn")&&function(){var t=d(i,r);h(i,t),b(i,u,l,p),A()}();a.classList.contains("cancel-deletion-btn")&&(a.closest('[class*="info"]').innerHTML="");a.classList.contains("show-form-btn")&&a.nextElementSibling.classList.toggle("hide");a.classList.contains("buy-car-btn")&&c("buy",".available-cars");a.classList.contains("sell-car-btn")&&c("sell",".own-cars");function c(t,n){var c=a.parentNode.querySelector(n);function s(t,n){return[d(n,t=parseInt(t)),f(n,t)]}c.value?"buy"===t?function(){if(function(){for(var t=0,n=0;n<c.options.length;n++){var e=c.options[n];if(e.selected){var a=_slicedToArray(s(e.value,carsDataArr),2)[1];t+=a.cost}}return t}()>m.balance)return w(c.nextElementSibling,"Not enough money for this order(");for(var t=0;t<c.options.length;t++){var n=c.options[t];if(n.selected){var e=_slicedToArray(s(n.value,carsDataArr),2),a=e[0],o=e[1];m.changeBalance(-o.cost),m.setCar(o),h(carsDataArr,a)}}b(carsDataArr,L,"car",CARS_STORAGE_NAME),b(i,u,l,p)}():function(){for(var t=0;t<c.options.length;t++){var n=c.options[t];if(n.selected){var e=_slicedToArray(s(n.value,m.cars),2),a=e[0],o=e[1];o.id=y(carsDataArr);var r=o.cost*CARS_RESIDUAL_VALUE_INDEX;m.changeBalance(r),m.deleteCar(a),v(carsDataArr,o)}}b(carsDataArr,L,"car",CARS_STORAGE_NAME),b(i,u,l,p)}():w(c.nextElementSibling)}function s(t,n,e){t.querySelector(e)?t.classList.toggle(n):t.classList.remove(n)}function f(t,n){return t.find(function(t){return t.id===n})}function d(t,n){return t.findIndex(function(t){return t.id===n})}function y(t){return t.length?t[t.length-1].id+1:1}function h(t,n){t.splice(n,1)}function v(t,n){t.push(n)}function A(){"car"===l&&document.querySelectorAll(".person-info, .company-info").forEach(function(t){return t.innerHTML=""})}function b(t,n,e,a){n.innerHTML="",localStorage.setItem(a,JSON.stringify(t)),createItemsList(n,e,t)}function g(t,n){for(var e in S(t),n){var a=t.elements[e];if(o=n[e],r=a.value,!o.test(r))return w(a.nextElementSibling),!1}var o,r;return!0}function w(t,n){n&&(t.textContent=n),t.classList.remove("hide")}function S(t){for(var n=0;n<t.elements.length;n++){var e=t.elements[n];"button"!==e.type&&e.nextElementSibling.classList.add("hide")}}function E(t){for(var n=[],e=0;e<t.elements.length;e++){var a=t.elements[e];"button"!==a.type&&("number"!==a.type?n.push(a.value):n.push(parseInt(a.value)))}return n}function C(t){for(var n=arguments.length,e=new Array(1<n?n-1:0),a=1;a<n;a++)e[a-1]=arguments[a];return _construct("person"===t?Person:"company"===t?Company:Car,e)}})}function createItemsFormsAndLists(){var t=document.querySelector(".new-person-form-wrapper"),n=document.querySelector(".new-company-form-wrapper"),e=document.querySelector(".new-car-form-wrapper"),a=_slicedToArray(getAllItemsLists(),3),o=a[0],r=a[1],c=a[2];createItemsList(o,"person",peopleDataArr),createItemsList(r,"company",companiesDataArr),createItemsList(c,"car",carsDataArr),(new Person).createForm(t),(new Company).createForm(n),(new Car).createForm(e)}function controlVisionOfBlocks(){var t=document.querySelector(".people-btn"),n=document.querySelector(".companies-btn"),e=document.querySelector(".cars-btn"),a=document.querySelector(".people"),o=document.querySelector(".companies"),r=document.querySelector(".cars"),c=[a,o,r];function s(t,n,e){var a=1<arguments.length&&void 0!==n?n:c,o=2<arguments.length&&void 0!==e?e:"hide";t.classList.contains(o)?(a.forEach(function(t){return t.classList.add(o)}),t.classList.remove(o)):t.classList.add(o)}t.addEventListener("click",function(){s(a)}),n.addEventListener("click",function(){s(o)}),e.addEventListener("click",function(){s(r)})}var PEOPLE_STORAGE_NAME="people-list",COMPANIES_STORAGE_NAME="companies-list",CARS_STORAGE_NAME="cars-list",CARS_RESIDUAL_VALUE_INDEX=.7;prepareData(),createItemsFormsAndLists(),controlVisionOfBlocks(),controlClicksOnMainBlock();